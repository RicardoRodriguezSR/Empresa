
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Areas</h2>

<p>
    <button class="btn btn-primary" id="btnNuevaArea">Nueva Area</button>
</p>

<div id="resultado"></div>

<div class="modal fade" id="modalNuevaArea" tabindex="-1" aria-labelledby="lblModalNuevaArea" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="lblModalNuevaArea">Nueva area</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="formCrearArea">
                    <div class="form-group">
                        <label for="NombreArea">Nombre del Área</label>
                        <input type="text" class="form-control" id="NombreArea" name="NombreArea" required>
                    </div>
                    <div class="form-group">
                        <label for="Descripcion">Descripción</label>
                        <textarea class="form-control" id="Descripcion" name="Descripcion" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="Departamento">Departamento</label>
                        <input type="text" class="form-control" id="Departamento" name="Departamento" required>
                    </div>
                    <div class="form-group">
                        <label for="Responsable">Responsable</label>
                        <input type="text" class="form-control" id="Responsable" name="Responsable" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                <button type="button" class="btn btn-primary" id="guardarArea">Guardar</button>
            </div>
        </div>
    </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
    $(document).ready(function () {

        cargarAreas();

        function cargarAreas() {
            console.log("Funcion");
            $.ajax({
                url: '/Areas/GetAreas',
                method: 'GET',
                dataType: 'json',
                success: function (response) {
                    let html = '<table class="table">'
                    html += `<tr>
                    <th>NombreArea</th>
                    <th>Descripcion</th>
                    <th>Departamento</th>
                    <th>Responsable</th>
                    <th>FechaCreacion</th>
                    <th>Estado</th>
                    <th>Acciones</th>
                </tr>`
                    $.each(response, function (index, Area) {
                        html += `<tr>
                        <td>${Area.NombreArea}</td>
                        <td>${Area.Descripcion}</td>
                        <td>${Area.Departamento}</td>
                        <td>${Area.Responsable}</td>
                        <td>${Area.FechaCreacion}</td>
                        <td>${Area.Estado == 1 ? `Activo` : `Inactivo`}</td>
                        <td>
                            <button class="btn btn-danger btnEliminarArea" data-id="${Area.AreaID}">Eliminar</button>
                        </td>
                    </tr>`
                    });
                    html += '</table>'

                    $('#resultado').html(html);
                },
                error: function (error) {
                    console.error("Error en la solicitud", error);
                }
            });
        }

        $('#btnNuevaArea').click(function () {
            $('#modalNuevaArea').modal('show');
        });

        $('#guardarArea').click(function () {
            var areaData = {
                NombreArea: $('#NombreArea').val(),
                Descripcion: $('#Descripcion').val(),
                Departamento: $('#Departamento').val(),
                Responsable: $('#Responsable').val(),
            };

            $.ajax({
                url: '/Areas/CrearArea',
                method: 'POST',
                data: JSON.stringify(areaData),
                contentType: 'application/json',
                success: function (response) {
                    $('#modalNuevaArea').modal('hide');
                    cargarAreas();
                },
                error: function (error) {
                    console.error("Error al crear el área", error);
                }
            });
        });

        $(document).on('click', '.btnEliminarArea', function () {
            const areaID = $(this).data('id');

            if (confirm("¿Estás seguro de que deseas eliminar esta area?")) {
                $.ajax({
                    url: '/Areas/EliminarArea',
                    method: 'POST',
                    data: { areaID: areaID },
                    success: function (response) {
                        cargarAreas();
                    },
                    error: function (error) {
                        console.error("Error al eliminar el area", error);
                    }
                });
            }
        });
    });
</script>